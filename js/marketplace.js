/**
 * Fiverr Marketplace Scroll
 * Handles marketplace endless scroll behaviour
 *
 * Dependencies:
 * - jQuery 1.91
 *
 * Borrowed logic from Paul Irish's Endless Scroll
 * https://github.com/paulirish/infinite-scroll
 */
(function(e,t,n){"use strict";t.mpscroll={defaults:{debug:!1,binder:t(e),infid:0,contentSelector:null,navSelector:"div.gig-load-more",distBuffer:40,distFromNavToBottom:n}};var r=function(r,i){function u(e){e==="unbind"?s.binder.unbind("smartscroll.mpscr."+s.infid):s.binder[e]("smartscroll.mpscr."+s.infid,function(){c()}),a("Binding",e)}function a(){if(!0!==s.debug)return;typeof console!="undefined"&&typeof console.log=="function"?Array.prototype.slice.call(arguments).length===1&&typeof Array.prototype.slice.call(arguments)[0]=="string"?console.log(Array.prototype.slice.call(arguments).toString()):console.log(Array.prototype.slice.call(arguments)):!Function.prototype.bind&&typeof console!="undefined"&&typeof console.log=="object"&&Function.prototype.call.call(console.log,console,Array.prototype.slice.call(arguments))}function f(){var n=0+t(document).height()-s.binder.scrollTop()-t(e).height();return a("math:",n,s.distFromNavToBottom),n-s.distBuffer<s.distFromNavToBottom}function l(){o.removeData("mpscroll"),u("unbind"),a("Instance is destroyed")}function c(){if(!f())return;a("Loading content ...");var e=t(s.contentSelector).find(s.navSelector);t(e).find("a").trigger("click")}this.element=t(r);var s=t.extend(!0,{},t.mpscroll.defaults,i),o=r;s.contentSelector=s.contentSelector||this.element,a("contentSelector:",s.contentSelector),s.distFromNavToBottom===n&&(s.distFromNavToBottom=t(document).height()-t(s.contentSelector).find(s.navSelector).offset().top,a("distFromNavToBottom: "+s.distFromNavToBottom)),i.debug&&Function.prototype.bind&&(typeof console=="object"||typeof console=="function")&&typeof console.log=="object"&&["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(e){console[e]=this.call(console[e],console)},Function.prototype.bind),u("bind"),t.extend(o.mpscroll,{destroy:l})};t.fn.mpscroll=function(e){return this.each(function(){var n=new r(t(this),e);t.data(this,"mpscroll",n)})};var i=t.event,s;i.special.smartscroll={setup:function(){t(this).bind("scroll",t.event.special.smartscroll.handler)},teardown:function(){t(this).unbind("scroll",t.event.special.smartscroll.handler)},handler:function(e,n){var r=this,i=arguments;e.type="smartscroll",s&&clearTimeout(s),s=setTimeout(function(){t(r).trigger(e.type,i)},n==="execAsap"?0:100)}},t.fn.smartscroll=function(e){return e?this.bind("smartscroll",e):this.trigger("smartscroll",["execAsap"])}})(window,jQuery),function(e){var t={totalGigs:0,init:function(){Fiverr.initfakeDropdown(),document.pageScope.totalGigs&&e(".mp-total-gigs").length>0&&this.initGigsTotal(),e(".main-category-search").length>0&&this.initMainCategoryMenu(),this.initHomePage(),this.initSearchPage(),this.initFeedbackPage(),(e("#search-form").length>0||e("#footer_search").length>0)&&this.initSearchForm(),!Fiverr.isMobile&&!Fiverr.ie&&e.stellar({horizontalScrolling:!1,responsive:!0,positionProperty:"transform",hideDistantElements:!1}),this.initTooltipTrigger()},initSearchForm:function(){var t=this;t.miniForm=e("#search-form"),t.miniInputToCheck=t.miniForm.find('input[type="text"]'),t.largeForm=e("#footer_search"),t.largeInputToCheck=t.largeForm.find('input[type="text"]'),t.errors={too_short:e('<div class="error-container"><p class="msg-error">'+e.t("search_validations.too_short")+"</p></div>"),too_long:e('<div class="error-container"><p class="msg-error">'+e.t("search_validations.too_long")+"</p></div>")};var n=function(){t.setEvents()};t.setEvents=function(){t.miniForm.submit(function(e){activeForm=t.miniForm,activeInput=t.miniInputToCheck,t.hideErrors(activeForm,activeInput);var n=t.checkForm(activeForm,activeInput);n&&(e.preventDefault(),t.showErrors(n,activeForm,activeInput),t.miniInputToCheck.focus())}),t.largeForm.submit(function(e){activeForm=t.largeForm,activeInput=t.largeInputToCheck,t.hideErrors(activeForm,activeInput);var n=t.checkForm(activeForm,activeInput);n&&(e.preventDefault(),t.showErrors(n,activeForm,activeInput),t.largeInputToCheck.focus())})},t.checkForm=function(t,n){var r=!1;return e(n).val().length<3?(e(n).addClass("with-error"),r="too_short"):e(n).val().length>40&&(e(n).addClass("with-error"),r="too_long"),r},t.showErrors=function(e,n,r){r.parent().append(t.errors[e].show())},t.hideErrors=function(e,t){t.removeClass("with-error"),e.find(".error-container").remove()},n()},initGigsTotal:function(){var e=parseInt(document.pageScope.totalGigs),n=parseInt(document.pageScope.totalGigsTs),r=Math.round((new Date).getTime()/1e3);e>1e4&&(e-=5e3),t.totalGigs=e,t.setGigsTotal();var i=setInterval(function(){t.setGigsTotal()},5e3)},setGigsTotal:function(){t.totalGigs++;var n=e(".mp-total-gigs .total-gig-counter"),r=t.totalGigs.toString(),i=r.split("");i.reverse(),n.empty(),e.each(i,function(e,r){n.prepend("<span>"+r+"</span>"),t.totalGigs>999&&e%3==2&&n.prepend('<span class="comma">,</span>')})},initMainCategoryMenu:function(){var t=e(".main-category-search .fake-dropdown-double .dropdown-menu ul").eq(0).find("a"),n=e(".main-category-search .fake-dropdown-double .dropdown-inner .arr"),r=e(".main-category-search .fake-dropdown-double .side-menu"),i=r.find("ul"),s=t.length,o=0,u=!1;o=s*25+1,r.css("min-height",o+"px"),i.eq(0).addClass("sub-open"),t.mouseenter(function(){u=!0,e(this).parent().hasClass("no-subcat")?f():a(t.index(this))}),e(".main-category-search .fake-dropdown-double").mouseleave(function(){e(this).hasClass("open")&&(u=!1,_.delay(l,1e3))});var a=function(e){r.show(),r.parent().find(".rightie").show(),n.show(),n.css("top",e*25+16+"px");var t=i.eq(e).find("li").length;t>s?r.css("height",t*25+1+"px"):r.css("height",o+"px"),i.removeClass("sub-open").eq(e).addClass("sub-open")},f=function(){r.hide(),r.parent().find(".rightie").hide(),n.hide()},l=function(){e(".main-category-search .fake-dropdown-double").hasClass("open")&&!u&&e(".main-category-search .fake-dropdown-double .dropdown-toggle").trigger("click")};Fiverr.initfakeDropdownReal(".fake-dropdown-category-search",function(t){var n=e(".fake-dropdown-category-search"),r=n.find(".dropdown-toggle"),i=n.data("field-name"),s=n.find("#"+i),o=e(t).data("field-value"),u=e(t).text();o=="everywhere"?(s.val(o),r.html(u),n.find("input#category").length>0&&n.find("input#category").remove(),r.removeClass("dropdown-toggle-green")):(n.find("input#category").length>0?n.find("input#category").val(o):n.prepend('<input id="category" name="category" type="hidden" value="'+o+'">'),s.val("category"),r.html(u),e(".main-category-search #query").val()!=""&&(r.addClass("dropdown-toggle-green"),e(".main-category-search #search-form").submit()))}),e(".main-category-search #query").bind("keyup change",function(t){var n=e(".fake-dropdown-category-search"),r=n.find(".dropdown-toggle"),i=n.find("input#search_in").val();e(this).val()!=""&&i=="category"?r.addClass("dropdown-toggle-green"):r.removeClass("dropdown-toggle-green")})},getWelcomeMessage:function(){var t=new Date,n=t.getHours(),r="",i=e(".mp-welcome-current"),s=i.find("h2");n>=7&&n<12?r="day-early":n>=12&&n<19?r="day-late":n>=19&&n<23?r="night-early":r="night-late",i.addClass(r),e.ajax({type:"get",dataType:"text",url:"/categories/homepage_personal_message?localtime="+n,async:!1,success:function(e){s.html(e).fadeIn("fast")}})},initHomePage:function(){e(".mp-welcome-current").length>0&&this.getWelcomeMessage(),e(".js-scroll-category-tree").length>0&&e(".js-scroll-category-tree").bind(Fiverr.clickEventType,function(t){t.preventDefault(),e.scrollTo(".mp-categories-columns",1500,{easing:"easeInOutQuart",offset:-155})}),e(".popup-how-it-works").length>0&&(e(".js-open-popup-howitworks").bind(Fiverr.clickEventType,function(t){t.preventDefault(),Fiverr.mainPopupBox=e(".popup-how-it-works").bPopup({amsl:0,closeClass:"btn-close",opacity:.8,follow:[!0,!1],position:["auto",-70],appending:!1})}),e(".mp-page-welcome .js-join-trigger").bind(Fiverr.clickEventType,function(e){e.preventDefault(),Fiverr.openInlineUserPopupNew("join")}),Fiverr.initSimpleSlider(e(".popup-how-it-works .js-how-to-sell"),function(){t(e(".popup-how-it-works .js-how-to-sell"))}),Fiverr.initSimpleSlider(e(".popup-how-it-works .js-how-to-buy"),function(){t(e(".popup-how-it-works .js-how-to-buy"))}),e(".popup-how-it-works .js-howitworks-buy").bind(Fiverr.clickEventType,function(t){t.preventDefault(),e(".popup-how-it-works .js-howitworks-sell").parent().removeClass("sel"),e(".popup-how-it-works .js-how-to-sell").hide(),e(".popup-how-it-works .js-howitworks-buy").parent().addClass("sel"),e(".popup-how-it-works .js-how-to-buy").show()}),e(".popup-how-it-works .js-howitworks-sell").bind(Fiverr.clickEventType,function(t){t.preventDefault(),e(".popup-how-it-works .js-howitworks-buy").parent().removeClass("sel"),e(".popup-how-it-works .js-how-to-buy").hide(),e(".popup-how-it-works .js-howitworks-sell").parent().addClass("sel"),e(".popup-how-it-works .js-how-to-sell").show()})),e(".gtm_event").bind(Fiverr.clickEventType,function(){var t=e(this).attr("data-gtm-name").toLowerCase();t=="home"||t=="start selling"||t=="sign in"||t=="join"?typeof dataLayer!="undefined"&&dataLayer.push({action:"black-nav",label:t,event:"navigation"}):typeof dataLayer!="undefined"&&dataLayer.push({action:t,event:"homepage"})});var t=function(e){var t=e.find(".js-gallery-marker"),n=parseInt(e.find(".js-coll-slider").css("left")),r=parseInt(e.find(".js-slide").width()),i=Math.abs(n)/r;t.find("span").removeClass("sel").eq(i).addClass("sel")}},initSearchPage:function(){e(".js-btn-toggle-user-search").bind(Fiverr.clickEventType,function(e){e.preventDefault(),History.pushState({layout:"profiles"},document.title,FiverrCategories.searchParams+"&layout=profiles")}),e(".js-btn-toggle-gig-search").bind(Fiverr.clickEventType,function(e){e.preventDefault(),History.pushState({layout:"auto"},document.title,FiverrCategories.searchParams+"&layout=auto")})},initFeedbackPage:function(){e(".js-open-feedback-form").length>0&&e(".js-open-feedback-form").bind(Fiverr.clickEventType,function(t){t.preventDefault(),e(this).fadeOut("fast",function(){e(".mp-feedback-form").slideDown(400)})}),e(".js-open-popup-feedback-resolution").length>0&&e(".js-open-popup-feedback-resolution").bind(Fiverr.clickEventType,function(t){t.preventDefault(),e(".popup-feedback-resolution").bPopup({amsl:120,closeClass:"btn-close",opacity:.6,follow:[!0,!0],appending:!1})})},initTooltipTrigger:function(){var t=e(".js-tooltip-trigger");if(t.length<1)return;e(t).on("mouseenter",function(){var t=e(this).data("target");e("."+t).show()}).on("mouseleave",function(){var t=e(this).data("target");e("."+t).hide()})}};window.FiverrMarketplace=t,e(document).ready(function(){t.init()})}(jQuery);